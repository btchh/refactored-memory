let r=null;window.openToggleStatusModal=function(e,t){r=e;const o=document.getElementById(`user-row-${e}`)?.dataset.userName||"this user",s=t==="active"?"disable":"enable",a=t==="active"?"Disable User":"Enable User",i=document.getElementById("toggle-status-modal"),c=document.getElementById("toggle-icon-container"),m=document.getElementById("toggle-modal-title"),u=document.getElementById("toggle-modal-message"),d=document.getElementById("confirm-toggle-btn");t==="active"?(c.className="w-12 h-12 rounded-xl bg-amber-100 flex items-center justify-center",c.innerHTML=`
            <svg class="w-6 h-6 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" />
            </svg>
        `,d.className="flex-1 px-4 py-2.5 bg-amber-600 hover:bg-amber-700 text-white font-medium rounded-xl transition-colors",d.textContent="Disable User"):(c.className="w-12 h-12 rounded-xl bg-emerald-100 flex items-center justify-center",c.innerHTML=`
            <svg class="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        `,d.className="flex-1 px-4 py-2.5 bg-emerald-600 hover:bg-emerald-700 text-white font-medium rounded-xl transition-colors",d.textContent="Enable User"),m.textContent=a,u.innerHTML=`Are you sure you want to ${s} <strong class="text-gray-900">${o}</strong>? ${t==="active"?"They will no longer be able to access their account.":"They will be able to access their account again."}`,i.classList.remove("hidden"),document.body.style.overflow="hidden"};window.closeToggleStatusModal=function(){document.getElementById("toggle-status-modal").classList.add("hidden"),document.body.style.overflow="",r=null};window.confirmToggleStatus=async function(){if(!r)return;const e=document.getElementById("confirm-toggle-btn"),t=e.textContent;e.disabled=!0,e.innerHTML='<svg class="animate-spin h-5 w-5 mx-auto" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>';try{const o=await(await fetch(window.userRoutes.toggleStatus.replace("__ID__",r),{method:"POST",headers:{"X-CSRF-TOKEN":window.userRoutes.csrf,"Content-Type":"application/json"}})).json();o.success?(l("success",o.message),closeToggleStatusModal(),setTimeout(()=>window.location.reload(),1e3)):(l("error",o.message),e.disabled=!1,e.textContent=t)}catch(n){console.error("Error:",n),l("error","Failed to update user status"),e.disabled=!1,e.textContent=t}};window.openDeleteModal=function(e){r=e;const n=document.getElementById(`user-row-${e}`)?.dataset.userName||"this user",o=document.getElementById("delete-user-modal"),s=document.getElementById("delete-user-name");s.textContent=n,o.classList.remove("hidden"),document.body.style.overflow="hidden"};window.closeDeleteModal=function(){document.getElementById("delete-user-modal").classList.add("hidden"),document.body.style.overflow="",r=null};window.confirmDelete=async function(){if(!r)return;const e=document.getElementById("confirm-delete-btn"),t=e.textContent;e.disabled=!0,e.innerHTML='<svg class="animate-spin h-5 w-5 mx-auto" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>';try{const o=await(await fetch(window.userRoutes.delete.replace("__ID__",r),{method:"DELETE",headers:{"X-CSRF-TOKEN":window.userRoutes.csrf,"Content-Type":"application/json"}})).json();if(o.success){l("success",o.message),closeDeleteModal();const s=document.getElementById(`user-row-${r}`);s&&(s.style.opacity="0",s.style.transform="translateX(-20px)",setTimeout(()=>s.remove(),300))}else l("error",o.message),e.disabled=!1,e.textContent=t}catch(n){console.error("Error:",n),l("error","Failed to delete user"),e.disabled=!1,e.textContent=t}};window.openRestoreModal=function(e){r=e;const n=document.getElementById(`user-row-${e}`)?.dataset.userName||"this user",o=document.getElementById("restore-user-modal"),s=document.getElementById("restore-user-name");s.textContent=n,o.classList.remove("hidden"),document.body.style.overflow="hidden"};window.closeRestoreModal=function(){document.getElementById("restore-user-modal").classList.add("hidden"),document.body.style.overflow="",r=null};window.confirmRestore=async function(){if(!r)return;const e=document.getElementById("confirm-restore-btn"),t=e.textContent;e.disabled=!0,e.innerHTML='<svg class="animate-spin h-5 w-5 mx-auto" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>';try{const o=await(await fetch(window.userRoutes.restore.replace("__ID__",r),{method:"POST",headers:{"X-CSRF-TOKEN":window.userRoutes.csrf,"Content-Type":"application/json"}})).json();if(o.success){l("success",o.message),closeRestoreModal();const s=document.getElementById(`user-row-${r}`);s&&(s.style.opacity="0",s.style.transform="translateX(20px)",setTimeout(()=>s.remove(),300))}else l("error",o.message),e.disabled=!1,e.textContent=t}catch(n){console.error("Error:",n),l("error","Failed to restore user"),e.disabled=!1,e.textContent=t}};document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".toggle-status-btn").forEach(e=>{e.addEventListener("click",function(){const t=this.dataset.userId,n=this.dataset.userStatus;openToggleStatusModal(t,n)})}),document.querySelectorAll(".delete-user-btn").forEach(e=>{e.addEventListener("click",function(){const t=this.dataset.userId;openDeleteModal(t)})}),document.querySelectorAll(".restore-user-btn").forEach(e=>{e.addEventListener("click",function(){const t=this.dataset.userId;openRestoreModal(t)})}),document.getElementById("confirm-toggle-btn")?.addEventListener("click",confirmToggleStatus),document.getElementById("confirm-delete-btn")?.addEventListener("click",confirmDelete),document.getElementById("confirm-restore-btn")?.addEventListener("click",confirmRestore),document.addEventListener("keydown",function(e){e.key==="Escape"&&(closeToggleStatusModal(),closeDeleteModal(),closeRestoreModal())})});function l(e,t){const n=document.getElementById("alert-container");if(!n)return;const o=e==="success"?"bg-emerald-50 text-emerald-800 border-emerald-200":"bg-rose-50 text-rose-800 border-rose-200",s=e==="success"?"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z":"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z",a=document.createElement("div");a.className=`flex items-center gap-3 p-4 rounded-xl border ${o} mb-4 shadow-sm transition-all`,a.innerHTML=`
        <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${s}" />
        </svg>
        <span class="flex-1 font-medium">${t}</span>
        <button onclick="this.parentElement.remove()" class="p-1 hover:bg-black/5 rounded-lg transition-colors">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
    `,n.appendChild(a),setTimeout(()=>{a.style.opacity="0",a.style.transform="translateY(-10px)",setTimeout(()=>a.remove(),300)},5e3)}
